<!-- ì‹œì„  ì•ˆì •ì„± ìƒì„¸ ì •ë³´ íŒì—… -->
<div id="gaze-details-popup" class="details-popup">
  <div class="details-popup-content">
    <div class="details-popup-header">
      <h3>ğŸ‘ï¸ ì‹œì„  ì•ˆì •ì„± ë¶„ì„ ìƒì„¸</h3>
      <button class="details-popup-close" onclick="closeGazeDetails()">Ã—</button>
    </div>
    <div class="details-popup-body">
      <div class="gaze-summary">
        <div class="gaze-main">
          <div class="gaze-label">ì‹œì„  ìƒíƒœ</div>
          <div id="gaze-main-value" class="gaze-main-value">-</div>
        </div>
        <div class="gaze-stability">
          <div class="gaze-label">ì•ˆì •ì„± ì ìˆ˜</div>
          <div id="gaze-stability-value" class="gaze-stability-value">-%</div>
        </div>
      </div>
      <div class="gaze-breakdown">
        <div class="gaze-label">ëœë“œë§ˆí¬ ì •ë³´</div>
        <div id="gaze-landmarks" class="gaze-landmarks">
          <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
        </div>
      </div>
      <div class="gaze-criteria">
        <div class="gaze-label">í‰ê°€ ê¸°ì¤€</div>
        <div id="gaze-criteria-text" class="gaze-criteria-text">
          ì‹œì„  ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
        </div>
      </div>
      <div class="gaze-explanation">
        <div class="gaze-label">ì ìˆ˜ ê³„ì‚° ê·¼ê±°</div>
        <div id="gaze-explanation-text" class="gaze-explanation-text">
          ì‹œì„  ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// ì‹œì„  ì•ˆì •ì„± ìƒì„¸ ì •ë³´ íŒì—… ê´€ë ¨ í•¨ìˆ˜ë“¤ (UI-only mode)
function updateGazeLandmarksInfo() {
    const landmarksDiv = document.getElementById('gaze-landmarks');
    
    // MediaPipe ë¶„ì„ê¸°ì—ì„œ ì‹¤ì‹œê°„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    let gazeData = window.currentGazeData;
    
    if (!gazeData && window.mediaPipeAnalyzer && window.mediaPipeAnalyzer.currentMediaPipeScores) {
        const currentScores = window.mediaPipeAnalyzer.currentMediaPipeScores;
        const gazeScore = currentScores.gaze || 0;
        
        gazeData = {
            score: gazeScore,
            isRealTime: true
        };
    }
    
    // ì‹¤ì‹œê°„ ì‹œì„  ë¶„ì„ ì •ë³´ í‘œì‹œ
    const landmarkInfo = [
        { 
            name: 'ì‹œì„  ë¶„ì„', 
            value: gazeData?.isRealTime ? 'í™œì„±í™”' : 'ëŒ€ê¸° ì¤‘', 
            description: gazeData?.isRealTime ? 'MediaPipe ê¸°ë°˜ ì‹¤ì‹œê°„ ì‹œì„  ë¶„ì„ì´ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.' : 'ì‹œì„  ë¶„ì„ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘ì…ë‹ˆë‹¤.' 
        },
        { 
            name: 'ëˆˆ ì¶”ì ', 
            value: gazeData?.isRealTime ? 'ì‹¤ì‹œê°„' : 'ëŒ€ê¸° ì¤‘', 
            description: gazeData?.isRealTime ? '32ê°œ ëˆˆ ëœë“œë§ˆí¬ë¥¼ í†µí•œ ì‹¤ì‹œê°„ ëˆˆ ì¶”ì ' : 'ëˆˆ ì¶”ì ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘ì…ë‹ˆë‹¤.' 
        },
        { 
            name: 'ì•ˆì •ì„± ì¸¡ì •', 
            value: gazeData?.isRealTime ? `${gazeData.score}%` : 'ì¸¡ì • ì¤‘', 
            description: gazeData?.isRealTime ? 'ì‹œì„  ë³€í™”ëŸ‰ê³¼ ì†ë„ë¥¼ í†µí•œ ì•ˆì •ì„± ì¸¡ì •' : 'ì•ˆì •ì„± ì¸¡ì •ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘ì…ë‹ˆë‹¤.' 
        }
    ];
    
    let html = '';
    landmarkInfo.forEach(item => {
        html += `
            <div class="landmark-item">
                <div class="landmark-name">${item.name}</div>
                <div class="landmark-value">${item.value}</div>
                <div class="landmark-description">${item.description}</div>
            </div>
        `;
    });
    
    landmarksDiv.innerHTML = html;
    
    if (gazeData?.isRealTime) {
        console.log("âœ… [íŒì—…] ì‹¤ì‹œê°„ ì‹œì„  ëœë“œë§ˆí¬ ì •ë³´ í‘œì‹œ ì™„ë£Œ");
    }
}

function updateGazeCriteriaInfo() {
    const criteriaDiv = document.getElementById('gaze-criteria-text');
    
    // MediaPipe ë¶„ì„ê¸°ì—ì„œ ì‹¤ì‹œê°„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    let gazeData = window.currentGazeData;
    
    if (!gazeData && window.mediaPipeAnalyzer && window.mediaPipeAnalyzer.currentMediaPipeScores) {
        const currentScores = window.mediaPipeAnalyzer.currentMediaPipeScores;
        const gazeScore = currentScores.gaze || 0;
        
        gazeData = {
            score: gazeScore,
            isRealTime: true
        };
    }
    
    const statusText = gazeData?.isRealTime ? 'ì‹¤ì‹œê°„ ë¶„ì„ ëª¨ë“œ' : 'ëŒ€ê¸° ëª¨ë“œ';
    
    const criteria = `
        <div class="criteria-section">
            <h4>ğŸ¯ ì‹œì„  ì•ˆì •ì„± í‰ê°€ ê¸°ì¤€ (${statusText})</h4>
            <ul>
                <li><strong>ì‹œì„  ë¶„ì„ ê¸°ëŠ¥</strong>: ${gazeData?.isRealTime ? 'MediaPipe ê¸°ë°˜ ì‹¤ì‹œê°„ ì‹œì„  ë¶„ì„ì´ í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.' : 'ì‹œì„  ë¶„ì„ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘ì…ë‹ˆë‹¤.'}</li>
                <li><strong>ì‹¤ì‹œê°„ ì¶”ì </strong>: ${gazeData?.isRealTime ? 'ì‹¤ì‹œê°„ ì‹œì„  ì¶”ì ì´ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.' : 'ì‹œì„  ì¶”ì ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘ì…ë‹ˆë‹¤.'}</li>
                <li><strong>ì•ˆì •ì„± ì¸¡ì •</strong>: ${gazeData?.isRealTime ? 'ì‹œì„  ì•ˆì •ì„± ì¸¡ì •ì´ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.' : 'ì•ˆì •ì„± ì¸¡ì •ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘ì…ë‹ˆë‹¤.'}</li>
            </ul>
            
            <h4>ğŸ‘ï¸ ì‹œì„  ë¶„ì„ ë°©ë²•</h4>
            <ul>
                <li><strong>ì–¼êµ´ ëœë“œë§ˆí¬</strong>: 468ê°œ ì–¼êµ´ ëœë“œë§ˆí¬ë¥¼ ì‚¬ìš©í•œ ì‹œì„  ë¶„ì„</li>
                <li><strong>ëˆˆ ì¶”ì </strong>: 32ê°œ ëˆˆ ëœë“œë§ˆí¬ë¥¼ í†µí•œ ì •í™•í•œ ëˆˆ ìœ„ì¹˜ ì¶”ì </li>
                <li><strong>ì‹œì„  ë°©í–¥</strong>: ëˆˆë™ì ì¤‘ì‹¬ì ì„ í†µí•œ ì‹œì„  ë°©í–¥ ê³„ì‚°</li>
                <li><strong>ì•ˆì •ì„± í‰ê°€</strong>: ì‹œì„  ë³€í™”ëŸ‰ê³¼ ì†ë„ë¥¼ í†µí•œ ì•ˆì •ì„± ì¸¡ì •</li>
            </ul>
            
            <h4>ğŸ“Š ì ìˆ˜ ê¸°ì¤€</h4>
            <ul>
                <li><strong>90-100ì </strong>: ë§¤ìš° ì•ˆì •ì ì¸ ì‹œì„  (ì§‘ì¤‘ë ¥ ìš°ìˆ˜)</li>
                <li><strong>70-89ì </strong>: ì•ˆì •ì ì¸ ì‹œì„  (ì ì ˆí•œ ì§‘ì¤‘)</li>
                <li><strong>50-69ì </strong>: ë³´í†µ ìˆ˜ì¤€ì˜ ì‹œì„  (ì¼ë°˜ì ì¸ ìƒíƒœ)</li>
                <li><strong>30-49ì </strong>: ë¶ˆì•ˆì •í•œ ì‹œì„  (ì§‘ì¤‘ë ¥ ì €í•˜)</li>
                <li><strong>0-29ì </strong>: ë§¤ìš° ë¶ˆì•ˆì •í•œ ì‹œì„  (ì‹¬ê°í•œ ì§‘ì¤‘ë ¥ ë¬¸ì œ)</li>
            </ul>
        </div>
    `;
    
    criteriaDiv.innerHTML = criteria;
}

function updateGazeExplanationInfo() {
    const explanationDiv = document.getElementById('gaze-explanation-text');
    
    // MediaPipe ë¶„ì„ê¸°ì—ì„œ ì‹¤ì‹œê°„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    let gazeData = window.currentGazeData;
    
    if (!gazeData && window.mediaPipeAnalyzer && window.mediaPipeAnalyzer.currentMediaPipeScores) {
        const currentScores = window.mediaPipeAnalyzer.currentMediaPipeScores;
        const gazeScore = currentScores.gaze || 0;
        
        gazeData = {
            score: gazeScore,
            isRealTime: true
        };
    }
    
    if (!gazeData) {
        explanationDiv.innerHTML = '<div class="explanation-section"><p>ë¶„ì„ ëŒ€ê¸° ì¤‘...</p></div>';
        return;
    }
    
    let explanation = `<div class="explanation-section">`;
    explanation += `<h4>ğŸ“ˆ í˜„ì¬ ë¶„ì„ ê²°ê³¼</h4>`;
    explanation += `<ul>`;
    explanation += `<li><strong>ì‹œì„  ì•ˆì •ì„± ì ìˆ˜</strong>: ${gazeData.score}ì </li>`;
    explanation += `<li><strong>ë¶„ì„ ìƒíƒœ</strong>: ${gazeData.isRealTime ? 'ì‹¤ì‹œê°„ ë¶„ì„ ì¤‘' : 'ëŒ€ê¸° ì¤‘'}</li>`;
    explanation += `<li><strong>ì‹œì„  ì¶”ì </strong>: ${gazeData.isRealTime ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}</li>`;
    explanation += `<li><strong>ì•ˆì •ì„± ì¸¡ì •</strong>: ${gazeData.isRealTime ? 'ì§„í–‰ ì¤‘' : 'ëŒ€ê¸° ì¤‘'}</li>`;
    explanation += `</ul>`;
    
    // ì ìˆ˜ í•´ì„
    if (gazeData.score >= 90) {
        explanation += `<p>ğŸ¯ <strong>ì™„ë²½í•œ ì‹œì„  ì•ˆì •ì„±</strong>: ì‹œì„ ì´ ë§¤ìš° ì•ˆì •ì ì´ê³  ì§‘ì¤‘ë ¥ì´ ìš°ìˆ˜í•©ë‹ˆë‹¤.</p>`;
    } else if (gazeData.score >= 70) {
        explanation += `<p>ğŸ¯ <strong>ìš°ìˆ˜í•œ ì‹œì„  ì•ˆì •ì„±</strong>: ì‹œì„ ì´ ì•ˆì •ì ì´ê³  ì ì ˆí•œ ì§‘ì¤‘ì„ ë³´ì…ë‹ˆë‹¤.</p>`;
    } else if (gazeData.score >= 50) {
        explanation += `<p>ğŸ¯ <strong>ë³´í†µ ì‹œì„  ì•ˆì •ì„±</strong>: ì¼ë°˜ì ì¸ ìˆ˜ì¤€ì˜ ì‹œì„  ì•ˆì •ì„±ì„ ë³´ì…ë‹ˆë‹¤.</p>`;
    } else if (gazeData.score >= 30) {
        explanation += `<p>ğŸ¯ <strong>ê°œì„ ì´ í•„ìš”í•œ ì‹œì„ </strong>: ì‹œì„ ì´ ë¶ˆì•ˆì •í•˜ê³  ì§‘ì¤‘ë ¥ì´ ì €í•˜ë˜ê³  ìˆìŠµë‹ˆë‹¤.</p>`;
    } else {
        explanation += `<p>ğŸ¯ <strong>ë§¤ìš° ê°œì„ ì´ í•„ìš”í•œ ì‹œì„ </strong>: ì‹œì„ ì´ ë§¤ìš° ë¶ˆì•ˆì •í•˜ê³  ì‹¬ê°í•œ ì§‘ì¤‘ë ¥ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.</p>`;
    }
    
    if (gazeData.isRealTime) {
        explanation += `<p>ğŸ”„ <strong>ì‹¤ì‹œê°„ ë¶„ì„</strong>: MediaPipe ê¸°ë°˜ ì‹¤ì‹œê°„ ì‹œì„  ë¶„ì„ì´ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.</p>`;
    }
    
    explanation += `</div>`;
    
    explanationDiv.innerHTML = explanation;
}

// ì „ì—­ ìŠ¤ì½”í”„ì— í•¨ìˆ˜ë“¤ ë…¸ì¶œ
window.updateGazeLandmarksInfo = updateGazeLandmarksInfo;
window.updateGazeCriteriaInfo = updateGazeCriteriaInfo;
window.updateGazeExplanationInfo = updateGazeExplanationInfo;
</script>
