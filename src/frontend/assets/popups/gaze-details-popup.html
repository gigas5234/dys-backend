<!-- 시선 안정성 상세 정보 팝업 -->
<div id="gaze-details-popup" class="details-popup">
  <div class="details-popup-content">
    <div class="details-popup-header">
      <h3>👁️ 시선 안정성 분석 상세</h3>
      <button class="details-popup-close" onclick="closeGazeDetails()">×</button>
    </div>
    <div class="details-popup-body">
      <div class="gaze-summary">
        <div class="gaze-main">
          <div class="gaze-label">시선 상태</div>
          <div id="gaze-main-value" class="gaze-main-value">-</div>
        </div>
        <div class="gaze-stability">
          <div class="gaze-label">안정성 점수</div>
          <div id="gaze-stability-value" class="gaze-stability-value">-%</div>
        </div>
      </div>
      <div class="gaze-breakdown">
        <div class="gaze-label">랜드마크 정보</div>
        <div id="gaze-landmarks" class="gaze-landmarks">
          <!-- 동적으로 생성됨 -->
        </div>
      </div>
      <div class="gaze-criteria">
        <div class="gaze-label">평가 기준</div>
        <div id="gaze-criteria-text" class="gaze-criteria-text">
          시선 분석 데이터가 없습니다.
        </div>
      </div>
      <div class="gaze-explanation">
        <div class="gaze-label">점수 계산 근거</div>
        <div id="gaze-explanation-text" class="gaze-explanation-text">
          시선 분석 데이터가 없습니다.
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// 시선 안정성 상세 정보 팝업 관련 함수들 (UI-only mode)
function updateGazeLandmarksInfo() {
    const landmarksDiv = document.getElementById('gaze-landmarks');
    
    // MediaPipe 분석기에서 실시간 데이터 가져오기
    let gazeData = window.currentGazeData;
    
    if (!gazeData && window.mediaPipeAnalyzer && window.mediaPipeAnalyzer.currentMediaPipeScores) {
        const currentScores = window.mediaPipeAnalyzer.currentMediaPipeScores;
        const gazeScore = currentScores.gaze || 0;
        
        gazeData = {
            score: gazeScore,
            isRealTime: true
        };
    }
    
    // 실시간 시선 분석 정보 표시
    const landmarkInfo = [
        { 
            name: '시선 분석', 
            value: gazeData?.isRealTime ? '활성화' : '대기 중', 
            description: gazeData?.isRealTime ? 'MediaPipe 기반 실시간 시선 분석이 진행 중입니다.' : '시선 분석을 기다리는 중입니다.' 
        },
        { 
            name: '눈 추적', 
            value: gazeData?.isRealTime ? '실시간' : '대기 중', 
            description: gazeData?.isRealTime ? '32개 눈 랜드마크를 통한 실시간 눈 추적' : '눈 추적을 기다리는 중입니다.' 
        },
        { 
            name: '안정성 측정', 
            value: gazeData?.isRealTime ? `${gazeData.score}%` : '측정 중', 
            description: gazeData?.isRealTime ? '시선 변화량과 속도를 통한 안정성 측정' : '안정성 측정을 기다리는 중입니다.' 
        }
    ];
    
    let html = '';
    landmarkInfo.forEach(item => {
        html += `
            <div class="landmark-item">
                <div class="landmark-name">${item.name}</div>
                <div class="landmark-value">${item.value}</div>
                <div class="landmark-description">${item.description}</div>
            </div>
        `;
    });
    
    landmarksDiv.innerHTML = html;
    
    if (gazeData?.isRealTime) {
        console.log("✅ [팝업] 실시간 시선 랜드마크 정보 표시 완료");
    }
}

function updateGazeCriteriaInfo() {
    const criteriaDiv = document.getElementById('gaze-criteria-text');
    
    // MediaPipe 분석기에서 실시간 데이터 가져오기
    let gazeData = window.currentGazeData;
    
    if (!gazeData && window.mediaPipeAnalyzer && window.mediaPipeAnalyzer.currentMediaPipeScores) {
        const currentScores = window.mediaPipeAnalyzer.currentMediaPipeScores;
        const gazeScore = currentScores.gaze || 0;
        
        gazeData = {
            score: gazeScore,
            isRealTime: true
        };
    }
    
    const statusText = gazeData?.isRealTime ? '실시간 분석 모드' : '대기 모드';
    
    const criteria = `
        <div class="criteria-section">
            <h4>🎯 시선 안정성 평가 기준 (${statusText})</h4>
            <ul>
                <li><strong>시선 분석 기능</strong>: ${gazeData?.isRealTime ? 'MediaPipe 기반 실시간 시선 분석이 활성화되어 있습니다.' : '시선 분석을 기다리는 중입니다.'}</li>
                <li><strong>실시간 추적</strong>: ${gazeData?.isRealTime ? '실시간 시선 추적이 진행 중입니다.' : '시선 추적을 기다리는 중입니다.'}</li>
                <li><strong>안정성 측정</strong>: ${gazeData?.isRealTime ? '시선 안정성 측정이 진행 중입니다.' : '안정성 측정을 기다리는 중입니다.'}</li>
            </ul>
            
            <h4>👁️ 시선 분석 방법</h4>
            <ul>
                <li><strong>얼굴 랜드마크</strong>: 468개 얼굴 랜드마크를 사용한 시선 분석</li>
                <li><strong>눈 추적</strong>: 32개 눈 랜드마크를 통한 정확한 눈 위치 추적</li>
                <li><strong>시선 방향</strong>: 눈동자 중심점을 통한 시선 방향 계산</li>
                <li><strong>안정성 평가</strong>: 시선 변화량과 속도를 통한 안정성 측정</li>
            </ul>
            
            <h4>📊 점수 기준</h4>
            <ul>
                <li><strong>90-100점</strong>: 매우 안정적인 시선 (집중력 우수)</li>
                <li><strong>70-89점</strong>: 안정적인 시선 (적절한 집중)</li>
                <li><strong>50-69점</strong>: 보통 수준의 시선 (일반적인 상태)</li>
                <li><strong>30-49점</strong>: 불안정한 시선 (집중력 저하)</li>
                <li><strong>0-29점</strong>: 매우 불안정한 시선 (심각한 집중력 문제)</li>
            </ul>
        </div>
    `;
    
    criteriaDiv.innerHTML = criteria;
}

function updateGazeExplanationInfo() {
    const explanationDiv = document.getElementById('gaze-explanation-text');
    
    // MediaPipe 분석기에서 실시간 데이터 가져오기
    let gazeData = window.currentGazeData;
    
    if (!gazeData && window.mediaPipeAnalyzer && window.mediaPipeAnalyzer.currentMediaPipeScores) {
        const currentScores = window.mediaPipeAnalyzer.currentMediaPipeScores;
        const gazeScore = currentScores.gaze || 0;
        
        gazeData = {
            score: gazeScore,
            isRealTime: true
        };
    }
    
    if (!gazeData) {
        explanationDiv.innerHTML = '<div class="explanation-section"><p>분석 대기 중...</p></div>';
        return;
    }
    
    let explanation = `<div class="explanation-section">`;
    explanation += `<h4>📈 현재 분석 결과</h4>`;
    explanation += `<ul>`;
    explanation += `<li><strong>시선 안정성 점수</strong>: ${gazeData.score}점</li>`;
    explanation += `<li><strong>분석 상태</strong>: ${gazeData.isRealTime ? '실시간 분석 중' : '대기 중'}</li>`;
    explanation += `<li><strong>시선 추적</strong>: ${gazeData.isRealTime ? '활성화' : '비활성화'}</li>`;
    explanation += `<li><strong>안정성 측정</strong>: ${gazeData.isRealTime ? '진행 중' : '대기 중'}</li>`;
    explanation += `</ul>`;
    
    // 점수 해석
    if (gazeData.score >= 90) {
        explanation += `<p>🎯 <strong>완벽한 시선 안정성</strong>: 시선이 매우 안정적이고 집중력이 우수합니다.</p>`;
    } else if (gazeData.score >= 70) {
        explanation += `<p>🎯 <strong>우수한 시선 안정성</strong>: 시선이 안정적이고 적절한 집중을 보입니다.</p>`;
    } else if (gazeData.score >= 50) {
        explanation += `<p>🎯 <strong>보통 시선 안정성</strong>: 일반적인 수준의 시선 안정성을 보입니다.</p>`;
    } else if (gazeData.score >= 30) {
        explanation += `<p>🎯 <strong>개선이 필요한 시선</strong>: 시선이 불안정하고 집중력이 저하되고 있습니다.</p>`;
    } else {
        explanation += `<p>🎯 <strong>매우 개선이 필요한 시선</strong>: 시선이 매우 불안정하고 심각한 집중력 문제가 있습니다.</p>`;
    }
    
    if (gazeData.isRealTime) {
        explanation += `<p>🔄 <strong>실시간 분석</strong>: MediaPipe 기반 실시간 시선 분석이 진행 중입니다.</p>`;
    }
    
    explanation += `</div>`;
    
    explanationDiv.innerHTML = explanation;
}

// 전역 스코프에 함수들 노출
window.updateGazeLandmarksInfo = updateGazeLandmarksInfo;
window.updateGazeCriteriaInfo = updateGazeCriteriaInfo;
window.updateGazeExplanationInfo = updateGazeExplanationInfo;
</script>
