<!-- ê¹œë¹¡ì„ ìƒì„¸ ì •ë³´ íŒì—… -->
<div id="blinking-details-popup" class="details-popup">
  <div class="details-popup-content">
    <div class="details-popup-header">
      <h3>ğŸ˜‰ ê¹œë¹¡ì„ ë¶„ì„ ìƒì„¸</h3>
      <button class="details-popup-close" onclick="closeBlinkingDetails()">Ã—</button>
    </div>
    <div class="details-popup-body">
      <div class="blinking-summary">
        <div class="blinking-main">
          <div class="blinking-label">ê¹œë¹¡ì„ ìƒíƒœ</div>
          <div id="blinking-main-value" class="blinking-main-value">-</div>
        </div>
        <div class="blinking-rate">
          <div class="blinking-label">ê¹œë¹¡ì„ ë¹ˆë„</div>
          <div id="blinking-rate-value" class="blinking-rate-value">-</div>
        </div>
        <div class="blinking-confidence">
          <div class="blinking-label">ì‹ ë¢°ë„</div>
          <div id="blinking-confidence-value" class="blinking-confidence-value">-%</div>
        </div>
        <div class="blinking-rate-info">
          <div class="blinking-label">ê¹œë¹¡ì„ ì •ë³´</div>
          <div id="blinking-rate-info" class="blinking-rate-info">-</div>
        </div>
      </div>
      <div class="blinking-breakdown">
        <div class="blinking-label">ë¶„ì„ ìš”ì†Œ</div>
        <div id="blinking-factors" class="blinking-factors">
          <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
        </div>
      </div>
      <div class="blinking-criteria">
        <div class="blinking-label">í‰ê°€ ê¸°ì¤€</div>
        <div id="blinking-criteria-text" class="blinking-criteria-text">
          ê¹œë¹¡ì„ ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
        </div>
      </div>
      <div class="blinking-explanation">
        <div class="blinking-label">ì ìˆ˜ ê³„ì‚° ê·¼ê±°</div>
        <div id="blinking-explanation-text" class="blinking-explanation-text">
          ê¹œë¹¡ì„ ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// ê¹œë¹¡ì„ ìƒì„¸ ì •ë³´ íŒì—… ê´€ë ¨ í•¨ìˆ˜ë“¤
function updateBlinkingFactorsInfo() {
    const factorsDiv = document.getElementById('blinking-factors');
    
    // MediaPipe ë¶„ì„ê¸°ì—ì„œ ì‹¤ì‹œê°„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    let blinkingData = window.currentBlinkingData;
    
    if (!blinkingData && window.mediaPipeAnalyzer && window.mediaPipeAnalyzer.currentMediaPipeScores) {
        const currentScores = window.mediaPipeAnalyzer.currentMediaPipeScores;
        const blinkingScore = currentScores.blinking || 0;
        
        blinkingData = {
            score: blinkingScore,
            isRealTime: true
        };
    }
    
    // ì‹¤ì‹œê°„ ê¹œë¹¡ì„ ë¶„ì„ ìš”ì†Œë“¤
    const factorInfo = [
        { 
            name: 'EAR (Eye Aspect Ratio)', 
            value: blinkingData?.isRealTime ? '0.2-0.3' : 'ì¸¡ì • ì¤‘', 
            description: blinkingData?.isRealTime ? 'ëˆˆì˜ ì¢…íš¡ë¹„ìœ¨ë¡œ ê¹œë¹¡ì„ ê°ì§€' : 'EAR ê°’ì„ ì¸¡ì •í•˜ëŠ” ì¤‘' 
        },
        { 
            name: 'ê¹œë¹¡ì„ ì„ê³„ê°’', 
            value: blinkingData?.isRealTime ? '0.21' : 'ì„¤ì •ë¨', 
            description: blinkingData?.isRealTime ? 'ê¹œë¹¡ì„ìœ¼ë¡œ íŒë‹¨í•˜ëŠ” EAR ê¸°ì¤€ê°’' : 'ê¹œë¹¡ì„ ì„ê³„ê°’ì´ ì„¤ì •ë¨' 
        },
        { 
            name: 'ê¹œë¹¡ì„ ì§€ì†ì‹œê°„', 
            value: blinkingData?.isRealTime ? '0.1-0.4ì´ˆ' : 'ë¶„ì„ ì¤‘', 
            description: blinkingData?.isRealTime ? 'ì¼ë°˜ì ì¸ ê¹œë¹¡ì„ ì§€ì† ì‹œê°„' : 'ê¹œë¹¡ì„ ì§€ì†ì‹œê°„ì„ ë¶„ì„í•˜ëŠ” ì¤‘' 
        },
        { 
            name: 'ì •ìƒ ê¹œë¹¡ì„ ë¹ˆë„', 
            value: blinkingData?.isRealTime ? '15-20íšŒ/ë¶„' : 'ì¸¡ì • ì¤‘', 
            description: blinkingData?.isRealTime ? 'ê±´ê°•í•œ ëˆˆì˜ ê¹œë¹¡ì„ ë¹ˆë„' : 'ê¹œë¹¡ì„ ë¹ˆë„ë¥¼ ì¸¡ì •í•˜ëŠ” ì¤‘' 
        },
        { 
            name: 'ëˆˆ ê±´ì¡°ì¦ ê°ì§€', 
            value: blinkingData?.isRealTime ? '5íšŒ/ë¶„ ì´í•˜' : 'ê°ì‹œ ì¤‘', 
            description: blinkingData?.isRealTime ? 'ëˆˆ ê±´ì¡°ì¦ ì˜ì‹¬ ê¸°ì¤€' : 'ëˆˆ ê±´ì¡°ì¦ì„ ê°ì‹œí•˜ëŠ” ì¤‘' 
        },
        { 
            name: 'ê³¼ë„í•œ ê¹œë¹¡ì„', 
            value: blinkingData?.isRealTime ? '25íšŒ/ë¶„ ì´ìƒ' : 'ê°ì‹œ ì¤‘', 
            description: blinkingData?.isRealTime ? 'ê¸´ì¥ì´ë‚˜ ìŠ¤íŠ¸ë ˆìŠ¤ ì˜ì‹¬ ê¸°ì¤€' : 'ê³¼ë„í•œ ê¹œë¹¡ì„ì„ ê°ì‹œí•˜ëŠ” ì¤‘' 
        }
    ];
    
    let html = '';
    factorInfo.forEach(item => {
        html += `
            <div class="factor-item">
                <div class="factor-name">${item.name}</div>
                <div class="factor-value">${item.value}</div>
                <div class="factor-description">${item.description}</div>
            </div>
        `;
    });
    
    factorsDiv.innerHTML = html;
    
    if (blinkingData?.isRealTime) {
        console.log("âœ… [íŒì—…] ì‹¤ì‹œê°„ ê¹œë¹¡ì„ ìš”ì†Œ ì •ë³´ í‘œì‹œ ì™„ë£Œ");
    }
}

function updateBlinkingCriteriaInfo() {
    const criteriaDiv = document.getElementById('blinking-criteria-text');
    
    const criteria = `
        <div class="criteria-section">
            <h4>ğŸ˜‰ ê¹œë¹¡ì„ í‰ê°€ ê¸°ì¤€</h4>
            <ul>
                <li><strong>EAR ê°’ (40%)</strong>: ëˆˆì˜ ì¢…íš¡ë¹„ìœ¨ ì¸¡ì •</li>
                <li><strong>ê¹œë¹¡ì„ ë¹ˆë„ (30%)</strong>: ë¶„ë‹¹ ê¹œë¹¡ì„ íšŸìˆ˜</li>
                <li><strong>ê¹œë¹¡ì„ íŒ¨í„´ (30%)</strong>: ê¹œë¹¡ì„ì˜ ê·œì¹™ì„±ê³¼ ìì—°ìŠ¤ëŸ¬ì›€</li>
            </ul>
            
            <h4>ğŸ‘ï¸ ê¹œë¹¡ì„ ë¶„ì„ ë°©ë²•</h4>
            <ul>
                <li><strong>ëˆˆ ìœ¤ê³½ ì¶”ì </strong>: 32ê°œ ëœë“œë§ˆí¬ë¡œ ëˆˆì˜ í˜•íƒœ ì¸¡ì •</li>
                <li><strong>EAR ê³„ì‚°</strong>: ëˆˆì˜ ë†’ì´ì™€ ë„ˆë¹„ ë¹„ìœ¨ ê³„ì‚°</li>
                <li><strong>ê¹œë¹¡ì„ ê°ì§€</strong>: EAR ê°’ì´ ì„ê³„ê°’ ì´í•˜ë¡œ ë–¨ì–´ì§ˆ ë•Œ</li>
                <li><strong>ë¹ˆë„ ë¶„ì„</strong>: ì¼ì • ì‹œê°„ ë™ì•ˆì˜ ê¹œë¹¡ì„ íšŸìˆ˜ ê³„ì‚°</li>
            </ul>
            
            <h4>ğŸ“Š ì ìˆ˜ ê¸°ì¤€</h4>
            <ul>
                <li><strong>90-100ì </strong>: ë§¤ìš° ìì—°ìŠ¤ëŸ¬ìš´ ê¹œë¹¡ì„ (ì™„ë²½í•œ ìƒíƒœ)</li>
                <li><strong>70-89ì </strong>: ìì—°ìŠ¤ëŸ¬ìš´ ê¹œë¹¡ì„ (ì¢‹ì€ ìƒíƒœ)</li>
                <li><strong>50-69ì </strong>: ë³´í†µ ê¹œë¹¡ì„ (ì¼ë°˜ì ì¸ ìƒíƒœ)</li>
                <li><strong>30-49ì </strong>: ë¶ˆê·œì¹™í•œ ê¹œë¹¡ì„ (ì£¼ì˜ í•„ìš”)</li>
                <li><strong>0-29ì </strong>: ë§¤ìš° ë¶ˆê·œì¹™í•œ ê¹œë¹¡ì„ (ì‹¬ê°í•œ ë¬¸ì œ)</li>
            </ul>
        </div>
    `;
    
    criteriaDiv.innerHTML = criteria;
}

function updateBlinkingExplanationInfo() {
    const explanationDiv = document.getElementById('blinking-explanation-text');
    
    if (!currentBlinkingData) {
        explanationDiv.innerHTML = 'ê¹œë¹¡ì„ ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.';
        return;
    }
    
    const { ear, blinkStatus, blinkRate, score } = currentBlinkingData;
    
    let explanation = `<div class="explanation-section">`;
    explanation += `<h4>ğŸ“ˆ í˜„ì¬ ë¶„ì„ ê²°ê³¼</h4>`;
    explanation += `<ul>`;
    explanation += `<li><strong>ê¹œë¹¡ì„ ìƒíƒœ</strong>: ${blinkStatus ? 'ê¹œë¹¡ì„ ì¤‘' : 'ëˆˆ ëœ¬ ìƒíƒœ'}</li>`;
    explanation += `<li><strong>EAR ê°’</strong>: ${ear.toFixed(3)}</li>`;
    explanation += `<li><strong>ê¹œë¹¡ì„ ë¹ˆë„</strong>: ${blinkRate}íšŒ/ë¶„</li>`;
    explanation += `<li><strong>ìµœì¢… ì ìˆ˜</strong>: ${score}ì </li>`;
    explanation += `</ul>`;
    
    // ì ìˆ˜ í•´ì„
    if (score >= 90) {
        explanation += `<p>ğŸ¯ <strong>ì™„ë²½í•œ ê¹œë¹¡ì„ íŒ¨í„´</strong>: ë§¤ìš° ìì—°ìŠ¤ëŸ½ê³  ê±´ê°•í•œ ê¹œë¹¡ì„ì„ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.</p>`;
    } else if (score >= 70) {
        explanation += `<p>ğŸ¯ <strong>ìì—°ìŠ¤ëŸ¬ìš´ ê¹œë¹¡ì„</strong>: ê±´ê°•í•˜ê³  ìì—°ìŠ¤ëŸ¬ìš´ ê¹œë¹¡ì„ì„ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.</p>`;
    } else if (score >= 50) {
        explanation += `<p>ğŸ¯ <strong>ë³´í†µ ê¹œë¹¡ì„</strong>: ì¼ë°˜ì ì¸ ìˆ˜ì¤€ì˜ ê¹œë¹¡ì„ì„ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.</p>`;
    } else if (score >= 30) {
        explanation += `<p>ğŸ¯ <strong>ê°œì„ ì´ í•„ìš”í•œ ê¹œë¹¡ì„</strong>: ê¹œë¹¡ì„ì´ ë‹¤ì†Œ ë¶ˆê·œì¹™í•˜ê±°ë‚˜ ë¶€ì¡±í•©ë‹ˆë‹¤.</p>`;
    } else {
        explanation += `<p>ğŸ¯ <strong>ë§¤ìš° ê°œì„ ì´ í•„ìš”í•œ ê¹œë¹¡ì„</strong>: ê¹œë¹¡ì„ì— ì‹¬ê°í•œ ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>`;
    }
    
    explanation += `</div>`;
    
    explanationDiv.innerHTML = explanation;
}

// ì „ì—­ ìŠ¤ì½”í”„ì— í•¨ìˆ˜ë“¤ ë…¸ì¶œ
window.updateBlinkingFactorsInfo = updateBlinkingFactorsInfo;
window.updateBlinkingCriteriaInfo = updateBlinkingCriteriaInfo;
window.updateBlinkingExplanationInfo = updateBlinkingExplanationInfo;
</script>
